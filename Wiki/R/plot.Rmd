---
title: "Plot"
date: "Updated: `r format(Sys.time(), '%d %B, %Y')`"
---

# Basic plot functions

 * points
 * lines
 * abline
 * rect : Draw One or More Rectangles
 * box  : Draw a box around the current plot
 * legend
 * text

# Graphic

## Histogram

```{r}
# Histogram with 5 breakpoints
hist(iris$Sepal.Length, breaks=10)
```


## Barplot

```{r}
m <- matrix( c(4,6,4,6,4,6), nrow=2 )
#      [,1] [,2] [,3]
# [1,]    4    4    4
# [2,]    6    6    6
barplot(m, legend=rownames(m), beside=TRUE)
```

## Boxplot

```{r}
# Sorting a boxplot based on median value
bymedian <- with(InsectSprays, reorder(spray, -count, median))
boxplot(count ~ bymedian, data = InsectSprays,
          xlab = "spray", ylab = "count", varwidth=TRUE,
          col = "lightgray")
```

## Rug plot

```{r}
# both 'density' and rug plot
x <- rexp(200)
plot(density(x))
rug(x)
```

## Q-Q plot

```{r}
x <- rnorm(100)
y <- rexp(100)
qqplot(x, y)
```


## Correlogram 
http://www.sthda.com/english/wiki/visualize-correlation-matrix-using-correlogram

```{r, warning=F, message=F}
library(corrplot)
corrplot(cor(mtcars), type="lower")
```


## Dendrograms 

https://rpubs.com/gaston/dendrograms

http://www.sigmath.es.osaka-u.ac.jp/shimo-lab/prog/pvclust/


```{r, warning=F}
hc <- hclust(dist(USArrests[1:7,]), "ave")

#--------- plot 
suppressMessages(library(dendextend))
dend1 <- as.dendrogram(hc)
cutree(dend1,h=70) # it now works on a dendrogram with dendextend library
dend1 <- color_branches(dend1, k = 4)
dend1 <- color_labels(dend1, k = 5)
plot(dend1)

#--------- plot 
clus5 = cutree(hc, 5)
plot(hc, xlab = ""
     , hang = -1 # set label height
)

rect.hclust(hc, h=70, border="blue")
rect.hclust(hc, h=30, border="red")

legend("topright", "(x,y)"
        , c("Strong relation - red", "Good relation - blue") # add text
        , text.col=c("red", "blue")
        , lty=-1 , pch=NA # set lyt and pch to remove the legend symbols
)

```



# Plot configuration

## multiple plots in one graph
```r
# multiple plots in one graph. e.g. 2 rows, 2 columns
par(mfrow=c(2,2),
     mar=c(3,1,3,1), oma=c(0,0,0,0) # margin: buttom left, top, right
     )
     
# switch between plots
p <- par('mfg')) # get the plot 
par(mfg = p)  # focus the plot
```

##  plot with multiple Y scales
```{r}
x<- 1:10
y1 <- sample(seq(1:50), 10) 
y2 <- sample(seq(100:200), 10) 

# all sides have 2 lines of space margin to give space for axis on the right
par(oma=c(2,2,2,2)) 
# first plot
plot(x=x, y=y1, type="l", col="red") 
# tell R to draw over the first plot
par(new=T) 
# do second plot
plot(x=x, y=y2, type ="l", ylab="", yaxt='n' )  
axis(4, (range(y2)), ylab='y2') # draw second axis on the right
mtext("y2", side=4, line=2.3, adj=0.5, cex=1) # add test label on the right
```

## rotating axis labels in R

las:
0: always parallel to the axis [default],
1: always horizontal,
2: always perpendicular to the axis,
3: always vertical.

```{r}
plot(iris$Sepal.Length, las=2)
```

## label all factor in axis
```{r}
df <- iris[sample(nrow(iris), 30), ]

plot(df$Petal.Width, xaxt="n", xlab = "" )
axis(1, at=1:nrow(df), labels=df$Species, las=2, cex.axis=0.7)
```

## fill a stair step function
```{r}
y <- runif(10, 1, 5)
x <- seq_along(y)
y2 <- rep(y, each=2)[-(length(y)*2)]
x2 <- rep(x, each=2)[-1]
x3 <- c(min(x2), x2, max(x2))
y3 <- c(0, y2, 0)

plot(x, y, pch=16)

polygon(x3, y3, border=NA, col="grey60")
lines(x2, y2)

```

## plot color
```r
# create a color pattern
cl <- rainbow(5)

# transparent color
library(scales)
col <- alpha("yellow", 0.4)

# use RColorBrewer library
# http://moderndata.plot.ly/create-colorful-graphs-in-r-with-rcolorbrewer-and-plotly/
RColorBrewer::brewer.pal(3, "Set2")

```

## use legend as text box
```r
legend("topright", "(x,y)"
     , "info text" , title = "title text" # add text
     , lty=-1 , pch=NA # set lyt and pch to remove the legend symbols
     )
```



# Shiny 

## Real time updating

```r
library(shiny)
library(magrittr)

ui <- shinyServer(fluidPage(
  plotOutput("my_plot")
))

server <- shinyServer(function(input, output, session){

  # Function to get new observations
  get_new_data <- function(){
    data <- rnorm(5) %>% rbind %>% data.frame
    return(data)
  }

  # Initialize my_data
  my_data <<- get_new_data()

  # Function to update my_data
  update_data <- function(){
    my_data <<- rbind(get_new_data(), my_data)
  }

  # Plot the 30 most recent values
  output$my_plot <- renderPlot({
    print("Render")
    invalidateLater(2000, session) # update once 2 seconds  
    # invalidation will not be tied to any session, and so it will still occur
    # invalidateLater(60000,NULL) 
    update_data()
    print(my_data)
    par(mfrow = c(2,2))
    plot(X1 ~ 1, data=my_data[1:30,], ylim=c(-3, 3), las=1, type="l")
    plot(X1 ~ 1, data=my_data[1:30,], ylim=c(-3, 3), las=1, type="p")
    plot(X1 ~ 1, data=my_data[1:30,], ylim=c(-3, 3), las=1, type="b")
    plot(X1 ~ 1, data=my_data[1:30,], ylim=c(-3, 3), las=1, type="l")
  }
  , height = 800, width = 1000 )
})

shinyApp(ui,server)
```
## Reactive programming

https://shinydata.wordpress.com/2015/02/02/a-few-things-i-learned-about-shiny-and-reactive-programming/

```r
shinyServer(function(input, output, session){

 # Get Lengths from user input   
 a <- eventReactive(input$do, {
       subset(dd, Wafer %in% input$wafer, select = Length) 
 })

 #Observe and update first set of radiobuttons based on a(). Does render   
  observe({ 
    z <- a()
    updateRadioButtons(session, "length", choices = unique(z$Length), inline=TRUE)
  })

  output$l <- renderDataTable({ a() })
})

shinyUI(fluidPage(

  actionButton("do", "Search wafer"),
  radioButtons("length", label="Length", choices=""),

  dataTableOutput(outputId="l")
  )
)

```

## Dynamic plot 
```r
max_plots <- 5

server <- shinyServer(function(input, output) {
  
  # Insert the right number of plot output objects into the web page
  output$plots <- renderUI({
    plot_output_list <- lapply(1:input$n, function(i) {
      plotname <- paste0("plot", i)
      dygraphOutput(plotname, width = "100%", height = "300px")
    })
    
    # Convert the list to a tagList - this is necessary for the list of items
    # to display properly.
    do.call(tagList, plot_output_list)
  })
  
  # Call renderPlot for each one. Plots are only actually generated when they
  # are visible on the web page.
  for (i in 1:max_plots) {
    # Need local so that each item gets its own number. Without it, the value
    # of i in the renderPlot() will be the same across all instances, because
    # of when the expression is evaluated.
    local({
      plotname <- paste0("plot", i)
      output[[plotname]] <- renderDygraph({
        dygraph(mdeaths, group = "all-one")
      })
    })
  }
})

ui <- shinyUI(
  wellPanel(
    sliderInput("n", "Number of plots", value=1, min=1, max=5),
    # This is the dynamic UI for the plots
    uiOutput("plots")
    )
)

shinyApp(ui,server)
```

## Styling Cells, Rows, and Tables
http://rstudio.github.io/DT/010-style.html

## Table with hyperlinls
```r
library(shiny)

createLink <- function(val) {
  sprintf('<a href="https://www.google.com/#q=%s" target="_blank" class="btn btn-primary">Info</a>',val)
}

ui <- fluidPage(
  p("Click the link in the table to seea google search for the car."),
  dataTableOutput('table1')
)

server <- function(input, output) {
  output$table1 <- renderDataTable({
    my_table <- cbind(rownames(mtcars), mtcars)
    colnames(my_table)[1] <- 'car'
    my_table$link <- createLink(my_table$car)
    return(my_table)
  }, escape = FALSE)
}

shinyApp(ui, server)
```
## rhandsontable example
```r
library(shiny)
library(rhandsontable)

ui=fluidPage(
  rHandsontableOutput('table'),
  verbatimTextOutput('selected')
)

server=function(input,output,session)({
  
  df=data.frame(N=c(1:10),L=LETTERS[1:10],M=LETTERS[11:20])
  df$chart = c(sapply(1:5,  function(x) jsonlite::toJSON(list(values=rnorm(5)
                                                              , options = list(type = "bar")))))
  
  output$table=renderRHandsontable(
    rhandsontable(df,selectCallback = TRUE, readOnly = T)
    %>% hot_table(highlightCol = F, highlightRow = TRUE)
    %>% hot_col("M",readOnly = F )
    %>% hot_col("chart", renderer = htmlwidgets::JS("renderSparkline"))
  )
  
  output$selected=renderPrint({
    cat('Selected Row:',input$table_select$select$r)
    cat('\nSelected Column:',input$table_select$select$c)
    cat('\nSelected Cell Value:',input$table_select$data[[input$table_select$select$r]][[input$table_select$select$c]])
    cat('\nSelected Range: R', input$table_select$select$r,'C',input$table_select$select$c,
        ':R',input$table_select$select$r2, 'C',input$table_select$select$c2, sep="")
    cat('\nChanged Cell Row Column:',input$table$changes$changes[[1]][[1]],
        input$table$changes$changes[[1]][[2]])    
    cat('\nChanged Cell Old Value:',input$table$changes$changes[[1]][[3]])
    cat('\nChanged Cell New Value:',input$table$changes$changes[[1]][[4]])
  })
}) 

shinyApp(ui, server)
```



# Other
Producing Simple Graphs with R : 
http://www.harding.edu/fmccown/r/

http://personality-project.org/r/r.plottingdates.html

*Hmisc*
http://rgm2.lab.nig.ac.jp/RGM2/func.php?rd_id=Hmisc:Ecdf

*heatmap-or-plot-for-a-correlation-matrix*
http://stackoverflow.com/questions/15887212/heatmap-or-plot-for-a-correlation-matrix
